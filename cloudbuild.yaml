steps:
  # Setup docker with buildkit and other fixes
  - name: "europe-west1-docker.pkg.dev/connectedcars-build/cloud-build-init/master"
  # Build all images
  - name: "gcr.io/cloud-builders/docker"
    entrypoint: "bash"
    args: ["-c", "./build-all.sh"]
    env:
      [
        "COMMIT_SHA=${COMMIT_SHA}",
        "BRANCH_NAME=${BRANCH_NAME}",
        "PROJECT_ID=${PROJECT_ID}",
        "PUSH=y",
      ]
    secretEnv: ["NPM_TOKEN"]
    timeout: 14400s
secrets:
  - kmsKeyName: projects/connectedcars-staging/locations/global/keyRings/cloudbuilder/cryptoKeys/connectedcars-builder
    secretEnv:
      NPM_TOKEN: CiQAg7wCPbJCtcy0GjqWBOCdE9jDePOQNpsajS4VGFUFGppKIYISUgBefMgerT6YQmqC5GGSmdDqnMgSs+FlbaRVQOVlXWr5H1GuvNr1fYNMwaQwjh59kBIZSe1kKqkhsaBWGBlbeQbvKlhDf2FFklFVxnBHAp1ZQE8=
timeout: 14460s
options:
  machineType: "E2_HIGHCPU_32"
